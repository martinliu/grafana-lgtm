

[SERVICE]
    Flush        1
    Log_Level    info
    Parsers_File /fluent-bit/etc/fluent-bit-parsers.conf


# 读取所有容器 JSON 日志文件
[INPUT]
    Name        tail
    Path        /var/lib/docker/containers/*/*.log
    Tag         docker.*
    Parser      docker
    Refresh_Interval 5
    Skip_Long_Lines On





# 如需追加容器元数据请用 record_modifier/modify 插件，docker 插件不可用


# 把时间字段固定为 ts，便于 ClickHouse 直接吃
[FILTER]
    Name         modify
    Match        docker.*
    Rename       time ts


# 直接用 HTTP 往 ClickHouse 批量写入（NDJSON）
# 说明：
# - 使用 JSONEachRow，并启用 best_effort 的时间解析与忽略未知字段
# - Fluent Bit 会自动带上 ts 字段（ISO8601），ClickHouse 负责解析
[OUTPUT]
    Name         http
    Match        docker.*
    Host         clickhouse
    Port         8123
    URI          /?query=INSERT%20INTO%20logs.docker_logs%20FORMAT%20JSONEachRow%20SETTINGS%20input_format_skip_unknown_fields%3D1%2C%20date_time_input_format%3D%27best_effort%27
    Format       json_lines
    HTTP_User    log_ingest
    HTTP_Passwd  log!123
    compress     gzip
